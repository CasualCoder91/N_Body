=================
Mock Observations
=================

Images of stars are generated using ScopeSim :cite:`Leschinski2020` with the MICADO_Sci instrument, the ELT telescope and the Armazones location package.
Parameters differing from default values are

#. SIM.sub_pixel.flag - Initial tests indicated the necessity of integrating sub pixel shifts
#. DET.width and DET.height - Width and height of the detector plane in pix are set ensuring the image contains the whole COV. The pixelscale scale (arcsec/pixel) the ELT is 0.004
#. OBS.dit - The exposure time is adjusted to one hour.
#. scao_const_psf.convolve_mode = "same" ??? what does this do.
#. scao_const_psf.rotational_blur_angle - to reflect the rotation of the point spread function (PSF) occurring during one hour, this angle is set to 15 degrees. However, with the approach discussed in :ref:`masking_bright_stars-label` this will have little to no impact on the results.

For each simulation two images, one for :math:`t=0` and one for math:`t=dt`, are stored as FITS files.

Creating Source Objects
-----------------------

ScopeSim requires one source object for each simulated star. Source objects contain spatial and spectral information.
The spatial information consists of x and y in arcsec relative to the FOV axis, here generated by a chain of transformations from GCA to HTP and stored in the appropriate database table.

The spectral information is acquired using multiple functions from the ScopeSim Templates library involving the following steps:

#. The spectral type of a star is determined by looking up the closest spectral type from "A Modern Mean Dwarf Stellar Color and Effective Temperature Sequence" :cite:`Mamajek2013` given its mass.
#. The spectrum is taken from Pickles catalogue :cite:`Pickles1998` requiring metallicity in range 0.5 - 2 solar and age of about 5 Gyr.
#. That spectrum is scaled such that it has 0 apparent Vega mag in the V filter.
#. The absolute magnitude :math:`M_V` of the star in the V filter is determined from its mass using :cite:`Mamajek2013` with linear interpolation.
#. The apparent magnitude :math:`m_V` is obtained from :math:`m_V = M_V + 5\log_{10}\left ( d \right )-5`
#. The interstellar extinction :math:`e` is taken into account using :cite:`Marshall2006`
#. The weight :math:`w` of the spectrum :math:`s` is defined as

..  math::
    F\left (x,y \right ) = s * w

and calculated via

..  math::
    w = \frac{F}{F_0} = 10^{0.4\left ( m_0-(m_V+e) \right )}=10^{-0.4 (m_V+e)}

